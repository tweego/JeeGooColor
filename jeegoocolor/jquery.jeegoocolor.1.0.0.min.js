/*!
 * Copyright (c) 2009 - 2013 Erik van den Berg (http://www.tweego.nl/jeegoocolor)
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * Consider linking back to author's homepage: http://www.tweego.nl
 *
 * Version: 1.0.0
 * Dependencies: jQuery 1.4.2+, jeegoopopup.1.0.0+, cookie plugin.
 */
(function(h){var a;var k=0;var m=k;var d;var c;var p;var o;var r=function(t){var v=[];for(var w in t){var u=t[w].toString(16);if(u.length==1){u="0"+u}v.push(u)}return v.join("")};var b=function(t){if(t.length==3){return{R:parseInt(t[0]+t[0],16),G:parseInt(t[1]+t[1],16),B:parseInt(t[2]+t[2],16)}}else{if(t.length==6){return{R:parseInt(t[0]+t[1],16),G:parseInt(t[2]+t[3],16),B:parseInt(t[4]+t[5],16)}}}};var l=function(F){var w=F.H;var u=F.S;var D=F.B;if(u==0){var t=Math.round(D*255);return{R:t,G:t,B:t}}w/=60;if(w==6){w=0}var v=Math.floor(w);var E=D*(1-u);var C=D*(1-u*(w-v));var B=D*(1-u*(1-(w-v)));var A;switch(v){case 0:A={R:D,G:B,B:E};break;case 1:A={R:C,G:D,B:E};break;case 2:A={R:E,G:D,B:B};break;case 3:A={R:E,G:C,B:D};break;case 4:A={R:B,G:E,B:D};break;default:A={R:D,G:E,B:C};break}return{R:Math.round(A.R*255),G:Math.round(A.G*255),B:Math.round(A.B*255)}};var e=function(v){var z,y,u,w;z=v.R/255;y=v.G/255;u=v.B/255;w={};var x=(z<y?z:y);if(x>u){x=u}var t=(z>y?z:y);if(t<u){t=u}var A=t-x;if(t==0){return{H:k,S:0,B:0}}else{if(A==0){return{H:k,S:0,B:t}}else{w.S=A/t;w.B=t}}if(z==t){w.H=60*((y-u)/A)}else{if(y==t){w.H=60*(2+(u-z)/A)}else{w.H=60*(4+(z-y)/A)}}if(w.H<0){w.H+=360}else{if(w.H>360){w.H%=360}}w.H=Math.round(w.H);return w};var j=function(){var t,u;if(h("#jg_color_s").hasClass("jg_color_error")){t=1;h("#jg_color_s").removeClass("jg_color_error")}else{t=h("#jg_color_s").val()/100}if(h("#jg_color_br").hasClass("jg_color_error")){u=1,h("#jg_color_br").removeClass("jg_color_error")}else{u=h("#jg_color_br").val()/100}s({H:m,S:t,B:u})};var n=function(){var t=l({H:k,S:1,B:1});h("#jg_color_hue").css("background","#"+r(t))};var s=function(u){var v,t,w;if(u.R!=undefined){v=u;var w=r(v);t=e({R:u.R,G:u.G,B:u.B})}else{if(u.H!=undefined){t=u;v=l({H:u.H,S:u.S,B:u.B});var w=r(v)}else{w=u;v=b(u);t=e({R:v.R,G:v.G,B:v.B})}}h("#jg_color_pointer").css("left",t.H-4+"px");h("#jg_color_selector").css({left:Math.round(t.S*255)-9+"px",top:Math.round((1-t.B)*255)-9+"px"}).show();if(t.H!=k){k=t.H;n()}m=t.H;h("#jg_color_preview").css("background","#"+w);h("#jg_color_r").val(v.R);h("#jg_color_g").val(v.G);h("#jg_color_b").val(v.B);h("#jg_color_h").val(t.H);h("#jg_color_s").val(Math.round(t.S*100));h("#jg_color_br").val(Math.round(t.B*100));h("#jg_color_hex").val(w);h("#jg_color_right input[type=text]").removeClass("jg_color_error")};var i=function(u){if(u==undefined){u=h("#jg_color_preview").css("backgroundColor")}if(parseInt(u,16)){return u}else{if(/^#/.test(u)){return u.replace(/^#/,"")}else{var t=u.match(/\d+/g);if(t&&t.length==3){return r({R:parseInt(t[0]),G:parseInt(t[1]),B:parseInt(t[2])})}else{return"000000"}}}};var f=function(v,w){var t=(v.pageX-w.left)/255;if(t<0){t=0}else{if(t>1){t=1}}var u=1-(v.pageY-w.top)/255;if(u<0){u=0}else{if(u>1){u=1}}s({H:k,S:t,B:u})};var g=function(u,v){var t=parseInt(u.pageX-v.left);if(t<0||t>360){return}m=t;j()};var q=function(u){if(h.cookie){var t=h.cookie(u.cookieName);return(t?t.split("#"):[])}return[]};h.jeegoocolor=function(u){var w=h.extend({width:419,height:340,scrolling:"no",history:24,resizable:false,cookieName:"jg_jeegoocolor",cancel:"Cancel",ok:"Ok"},u||{});if(w.onClose){w._orgOnClose=w.onClose}w.onClose=function(y){k=0;if(w._orgOnClose){w._orgOnClose(y)}};var t="";var x=q(w).reverse();for(var v=0;v<x.length;v++){if(v>w.history){break}t+='<span style="background:#'+x[v]+'"></span>'}w.html='<div id="jg_color_huebar"><span id="jg_color_min"></span><span id="jg_color_selecthue"><span id="jg_color_pointer"></span></span><span id="jg_color_plus"></span></div><div id="jg_color_left"><div id="jg_color_hue"><div id="jg_color_selector"></div><div id="jg_color_black"></div><div id="jg_color_white"></div></div><div id="jg_color_recent">'+t+'</div></div><div id="jg_color_right"><div id="jg_color_preview" style="background:#000000"></div><div class="jg_color_row"><label for="jg_color_r">R:</label><input id="jg_color_r" type="text" value="0" class="jg_color_text" /><label for="jg_color_h">H:</label><input id="jg_color_h" type="text" value="0" class="jg_color_text" /> &#xb0;</div><div class="jg_color_row"><label for="jg_color_g">G:</label><input id="jg_color_g" type="text" value="0" class="jg_color_text" /><label for="jg_color_s">S:</label><input id="jg_color_s" type="text" value="0" class="jg_color_text" /> %</div><div class="jg_color_row"><label for="jg_color_b">B:</label><input id="jg_color_b" type="text" value="0" class="jg_color_text" /><label for="jg_color_br">B:</label><input id="jg_color_br" type="text" value="0" class="jg_color_text" /> %</div><div class="jg_color_row"><label for="jg_color_hex">#:</label><input id="jg_color_hex" type="text" value="000000" class="jg_color_text" /></div><div class="jg_color_row jg_color_buttons"><input type="button" id="jg_color_cancel" value="'+w.cancel+'" /><input type="button" id="jg_color_ok" value="'+w.ok+'" /></div>';'</div><div class="clear:both"></div>';setTimeout(function(){h.jeegoopopup.open(w);if(w&&w.color){s(i(w.color))}h("#jg_color_hue").unbind().mousedown(function(y){var z=h(this).offset();f(y,z);h(document).bind("mousemove.jg_color_color",function(A){f(A,z)}).bind("mouseup.jg_color_color",function(A){h(this).unbind(".jg_color_color")})});h("#jg_color_min").unbind().mousedown(function(y){h(this).addClass("jg_color_pressed");a=window.setInterval(function(){m--;if(m<0){m=0}j()},40)}).bind("mouseup mouseleave",function(y){h(this).removeClass("jg_color_pressed");window.clearInterval(a)});h("#jg_color_plus").unbind().mousedown(function(y){h(this).addClass("jg_color_pressed");a=window.setInterval(function(){m++;if(m>360){m=360}j()},40)}).bind("mouseup mouseleave",function(y){h(this).removeClass("jg_color_pressed");window.clearInterval(a)});h("#jg_color_selecthue").unbind().mousedown(function(y){var z=h(this).offset();g(y,z);h(document).bind("mousemove.jg_color_hue",function(A){g(A,z)}).bind("mouseup.jg_color_hue",function(A){h(this).unbind(".jg_color_hue")})});h("div.jg_color_row input[type=text]").unbind().keyup(function(E){var y=h(this).attr("id");if(y=="jg_color_r"||y=="jg_color_g"||y=="jg_color_b"){var F=false;var z=parseInt(h("#jg_color_r").val());if(isNaN(z)||z<0||z>255){F=true;h("#jg_color_r").addClass("jg_color_error")}else{h("#jg_color_r").removeClass("jg_color_error")}var A=parseInt(h("#jg_color_g").val());if(isNaN(A)||A<0||A>255){F=true;h("#jg_color_g").addClass("jg_color_error")}else{h("#jg_color_g").removeClass("jg_color_error")}var I=parseInt(h("#jg_color_b").val());if(isNaN(I)||I<0||I>255){F=true;h("#jg_color_b").addClass("jg_color_error")}else{h("#jg_color_b").removeClass("jg_color_error")}if(F){return false}s({R:z,G:A,B:I})}else{if(y=="jg_color_hex"){var H=h("#jg_color_hex").val();var B=H.length;var F=false;if(B==3){if(isNaN(parseInt(H[0],16))||isNaN(parseInt(H[1],16))||isNaN(parseInt(H[2],16))){F=true}}else{if(B==6){if(isNaN(parseInt(H[0]+H[1],16))||isNaN(parseInt(H[2]+H[3],16))||isNaN(parseInt(H[4]+H[5],16))){F=true}}else{F=true}}if(F){h("#jg_color_hex").addClass("jg_color_error");return false}else{s(h(this).val())}}else{var F=false;var D=parseInt(h("#jg_color_h").val());if(isNaN(D)||D<0||D>360){F=true;h("#jg_color_h").addClass("jg_color_error")}else{h("#jg_color_h").removeClass("jg_color_error")}var C=parseInt(h("#jg_color_s").val());if(isNaN(C)||C<0||C>100){F=true;h("#jg_color_s").addClass("jg_color_error")}else{h("#jg_color_s").removeClass("jg_color_error")}var G=parseInt(h("#jg_color_br").val());if(isNaN(G)||G<0||G>100){F=true;h("#jg_color_br").addClass("jg_color_error")}else{h("#jg_color_br").removeClass("jg_color_error")}if(F){return false}s({H:D,S:C/100,B:G/100})}}});h("#jg_color_recent span").unbind().click(function(){s(i(h(this).css("backgroundColor")))});h("#jg_color_cancel").unbind().click(function(y){k=0;h.jeegoopopup.close()});h("#jg_color_ok").unbind().click(function(C){h.jeegoopopup.close(true);k=0;if(w&&w.onPick){var y=i();if(h.cookie){var z=q(w);z.reverse();var B=false;for(var A=0;A<z.length;A++){if(A<w.history){if(z[A]==y){B=true;break}}else{break}}z.reverse();if(!B){z.push(y)}h.cookie(w.cookieName,z.reverse().slice(0,w.history).reverse().join("#"))}w.onPick(y)}})},0)}})(jQuery);